# gitlab-api

Данный проект позволяет упростить работу с API gitlab из командной строки.

# Начало работы

В пайплайне из исходников собирается исполняемый файл `gitlab-ta` и сохраняется как артефакт. Его надо скачать себе на локальную машину. Для того, чтобы начать использовать скрипт нужно в переменных окружения на своей машине прописать адрес и токен доступа.
```bash
export GL_ADDRESS=http://<ip-address>/ # адрес gitlab-сервера
```
```bash
export GL_TOKEN=<Access Token> # пользовательский токен доступа
```

**!!!Важно!!!** Использование токенов не админских аккаунтов может привести к некорректному поведению / неполному выводу данных. (Часть полей API отдает только пользователям с админскими привелегиями).

# Как работать с проектом

## Сборка проекта

```bash
go build -o gitlab-api .
```

После того как исполняемый файл скомпилирован и переменные окружения прописаны, скрипт можно запускать. В данном проекте представлен пример получения информации о группах/проектах в которых состоит пользователь.
Определение того, какие объекты запрашивать и какие данные о них выводить, реализованно через флаги.

---

<details close>
    <summary><b>Memberships</b></summary>

Выводит группы/проекты в которых участвует пользователь по его `id` или `username`.

Чтобы выбрать эту группу объектов:

`-src=memberships` или `--src=memberships`

**Обязательно** нужен один из флагов `-id` или `-name`:

- `-id` - ID пользователя, группы и проекты которого необходимо вывести.
- `-name` - username пользователя, группы и проекты которого необходимо вывести.

**Опции** (задают какие колонки вывести):

- `-opt=i` - (*ID*) Вывести ID проекта.
- `-opt=a` - (*Access Level*) Вывести уровень доступа участника к проекту.
- `-opt=n` - (*Source Name*) Вывести название проекта.
- `-opt=t` - (*Source Type*) Вывести тип проекта.

<details close>
    <summary><b>Примеры использования Memberships</b></summary>

```bash
### Вывести группы где участвует пользователь с ID = 12
./gitlab-api -src=memberships -id=12

### Вывести группы где участвует пользователь с name = admin201
./gitlab-api -src=memberships -name=admin201

### Вывести полную информацию о проектах где пользователь является участником
./gitlab-api -src=memberships
```
</details>
</details>

---

<details close>
    <summary><b>Использованине с другими утилитами</b></summary>

Так как программа осуществляет вывод в стандартный поток ввода/вывода в командой строке, поддерживается взаимодействие с другими стандартными утилитами Linux.

**Примеры использования с другими утилитами Linux**

```bash
# Записать вывод в файл
./gitlab-ta -src=memberships -opt=iat -id=12 > output.txt

# Выбор нескольких строк из вывода команды через grep
./gitlab-ta -src=memberships -opt=iat -id=12 | grep 'sources' > output.txt
```
</details>

## Автор
Харламов Андрей andreshrlmv@gmail.com
